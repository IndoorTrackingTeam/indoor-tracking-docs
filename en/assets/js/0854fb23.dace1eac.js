"use strict";(self.webpackChunkdocs_it=self.webpackChunkdocs_it||[]).push([[49],{9477:(n,e,i)=>{i.r(e),i.d(e,{assets:()=>t,contentTitle:()=>d,default:()=>p,frontMatter:()=>s,metadata:()=>r,toc:()=>c});const r=JSON.parse('{"id":"esp32/esp32-collection","title":"Coleta de dados","description":"Como configurar o c\xf3digo do ESP32 para coletar dados.","source":"@site/docs/esp32/collection.md","sourceDirName":"esp32","slug":"/esp32-collection","permalink":"/indoor-tracking-docs/en/docs/esp32-collection","draft":false,"unlisted":false,"editUrl":"https://github.com/facebook/docusaurus/tree/main/packages/create-docusaurus/templates/shared/docs/esp32/collection.md","tags":[],"version":"current","sidebarPosition":3,"frontMatter":{"id":"esp32-collection","title":"Coleta de dados","description":"Como configurar o c\xf3digo do ESP32 para coletar dados.","slug":"/esp32-collection","sidebar_position":3},"sidebar":"tutorialSidebar","previous":{"title":"Treinamento","permalink":"/indoor-tracking-docs/en/docs/esp32-training"}}');var o=i(4848),a=i(8453);const s={id:"esp32-collection",title:"Coleta de dados",description:"Como configurar o c\xf3digo do ESP32 para coletar dados.",slug:"/esp32-collection",sidebar_position:3},d="Coleta de dados",t={},c=[{value:"Passo 1: Inicialize as bibliotecas necess\xe1rias",id:"passo-1-inicialize-as-bibliotecas-necess\xe1rias",level:3},{value:"Passo 2: Configure os dados de acesso da rede e da API",id:"passo-2-configure-os-dados-de-acesso-da-rede-e-da-api",level:3},{value:"Passo 3: Adicione a configura\xe7\xe3o da saida serial e da conex\xe3o com o Wi-Fi",id:"passo-3-adicione-a-configura\xe7\xe3o-da-saida-serial-e-da-conex\xe3o-com-o-wi-fi",level:3},{value:"Passo 4: Adicione o envio de dados para o banco via API",id:"passo-4-adicione-o-envio-de-dados-para-o-banco-via-api",level:3},{value:"Passo 4: Adicione o loop principal",id:"passo-4-adicione-o-loop-principal",level:3},{value:"Codigo completo",id:"codigo-completo",level:3}];function l(n){const e={admonition:"admonition",code:"code",h1:"h1",h3:"h3",header:"header",p:"p",pre:"pre",...(0,a.R)(),...n.components};return(0,o.jsxs)(o.Fragment,{children:[(0,o.jsx)(e.header,{children:(0,o.jsx)(e.h1,{id:"coleta-de-dados",children:"Coleta de dados"})}),"\n",(0,o.jsx)(e.admonition,{type:"info",children:(0,o.jsx)(e.p,{children:"Este guia ir\xe1 ajud\xe1-lo a configurar o c\xf3digo do ESP32 para coletar dados e envi\xe1-los ao banco de dados para posteriormente serem usados na localiza\xe7\xe3o do equipamento."})}),"\n",(0,o.jsx)(e.h3,{id:"passo-1-inicialize-as-bibliotecas-necess\xe1rias",children:"Passo 1: Inicialize as bibliotecas necess\xe1rias"}),"\n",(0,o.jsx)(e.pre,{children:(0,o.jsx)(e.code,{className:"language-C",children:"#include <WiFi.h>\r\n#include <WiFiClientSecure.h>\n"})}),"\n",(0,o.jsx)(e.h3,{id:"passo-2-configure-os-dados-de-acesso-da-rede-e-da-api",children:"Passo 2: Configure os dados de acesso da rede e da API"}),"\n",(0,o.jsx)(e.pre,{children:(0,o.jsx)(e.code,{className:"language-C",children:'const char* ssid = "NOME DA REDE";\r\nconst char* password = "SENHA DA REDE";\r\nconst char* host = "run-api-dev-131050301176.us-east1.run.app";\r\nconst char* url = "/router/data/create";\r\nString esp_id = "NUMERO DE ID ESP";\n'})}),"\n",(0,o.jsx)(e.h3,{id:"passo-3-adicione-a-configura\xe7\xe3o-da-saida-serial-e-da-conex\xe3o-com-o-wi-fi",children:"Passo 3: Adicione a configura\xe7\xe3o da saida serial e da conex\xe3o com o Wi-Fi"}),"\n",(0,o.jsx)(e.pre,{children:(0,o.jsx)(e.code,{className:"language-C",children:'void setup() {\r\n  Serial.begin(115200);\r\n  delay(10);\r\n\r\n  WiFi.begin(ssid, password);\r\n\r\n  while (WiFi.status() != WL_CONNECTED) {\r\n    delay(500);\r\n  }\r\n\r\n  Serial.println("WiFi connected");\r\n}\n'})}),"\n",(0,o.jsx)(e.h3,{id:"passo-4-adicione-o-envio-de-dados-para-o-banco-via-api",children:"Passo 4: Adicione o envio de dados para o banco via API"}),"\n",(0,o.jsx)(e.pre,{children:(0,o.jsx)(e.code,{className:"language-C",children:'void sendDataToAPI(String esp_id, int networks) {\r\n\r\n  WiFiClientSecure client;\r\n  client.setInsecure();\r\n\r\n  if (!client.connect(host, 443)) {\r\n    Serial.println("Connection failed");\r\n    return;\r\n  }\r\n\r\n  String payload = "{";\r\n  payload += "\\"esp_id\\": \\"" + esp_id + "\\",";\r\n  payload += "\\"networks\\": [";\r\n\r\n  for (int i = 0; i < networks; ++i) {\r\n    String mac = WiFi.BSSIDstr(i);\r\n    String ssid = WiFi.SSID(i);\r\n    int rssi = WiFi.RSSI(i);  \r\n\r\n    payload += "{\\"mac\\": \\"" + mac + "\\", \\"name_router\\": \\"" + ssid +  "\\", \\"rssi\\": " + String(rssi) + "}";\r\n\r\n    if (i < networks - 1) {\r\n      payload += ",";\r\n    }\r\n  }\r\n\r\n  payload += "]}";\r\n\r\n  client.print(String("POST ") + url + " HTTP/1.1\\r\\n" + \r\n               "Host: " + host + "\\r\\n" + \r\n               "Content-Type: application/json\\r\\n" + \r\n               "Content-Length: " + String(payload.length()) + "\\r\\n" + \r\n               "Connection: close\\r\\n\\r\\n" + \r\n               payload);\r\n\r\n  Serial.println(client.readStringUntil(\'\\n\'));\r\n\r\n  client.stop();\r\n\r\n  delay(5000);\r\n}\n'})}),"\n",(0,o.jsx)(e.h3,{id:"passo-4-adicione-o-loop-principal",children:"Passo 4: Adicione o loop principal"}),"\n",(0,o.jsx)(e.pre,{children:(0,o.jsx)(e.code,{className:"language-C",children:"void loop() {\r\n  String ssid;\r\n  String bssid;\r\n  int rssi = 0;\r\n\r\n  int networks = WiFi.scanNetworks();\r\n  if (networks > 0) {\r\n    sendDataToAPI(esp_id, networks);\r\n  }\r\n\r\n  delay(5000);\r\n}\n"})}),"\n",(0,o.jsx)(e.h3,{id:"codigo-completo",children:"Codigo completo"}),"\n",(0,o.jsx)(e.admonition,{type:"info",children:(0,o.jsxs)(e.p,{children:["Rodando este c\xf3digo os dados captados pelo ESP32 ser\xe3o enviados a cada 10 segundos para o banco de dados via API. (O delay de envio de dados pode ser alterado na fun\xe7\xe3o de ",(0,o.jsx)(e.code,{children:"loop"}),")"]})}),"\n",(0,o.jsx)(e.pre,{children:(0,o.jsx)(e.code,{className:"language-C",children:'#include <WiFi.h>\r\n#include <WiFiClientSecure.h>\r\n\r\nconst char* ssid = "NOME DA REDE";\r\nconst char* password = "SENHA DA REDE";\r\nconst char* host = "run-api-dev-131050301176.us-east1.run.app";\r\nconst char* url = "/router/data/create";\r\nString esp_id = "NUMERO DE ID ESP";\r\n\r\nvoid setup() {\r\n  Serial.begin(115200);\r\n  delay(10);\r\n\r\n  WiFi.begin(ssid, password);\r\n\r\n  while (WiFi.status() != WL_CONNECTED) {\r\n    delay(500);\r\n  }\r\n\r\n  Serial.println("WiFi connected");\r\n}\r\n\r\nvoid sendDataToAPI(String esp_id, int networks) {\r\n\r\n  WiFiClientSecure client;\r\n  client.setInsecure();\r\n\r\n  if (!client.connect(host, 443)) {\r\n    Serial.println("Connection failed");\r\n    return;\r\n  }\r\n\r\n  String payload = "{";\r\n  payload += "\\"esp_id\\": \\"" + esp_id + "\\",";\r\n  payload += "\\"networks\\": [";\r\n\r\n  for (int i = 0; i < networks; ++i) {\r\n    String mac = WiFi.BSSIDstr(i);\r\n    String ssid = WiFi.SSID(i);\r\n    int rssi = WiFi.RSSI(i);  \r\n\r\n    payload += "{\\"mac\\": \\"" + mac + "\\", \\"name_router\\": \\"" + ssid +  "\\", \\"rssi\\": " + String(rssi) + "}";\r\n\r\n    if (i < networks - 1) {\r\n      payload += ",";\r\n    }\r\n  }\r\n\r\n  payload += "]}";\r\n\r\n  client.print(String("POST ") + url + " HTTP/1.1\\r\\n" + \r\n               "Host: " + host + "\\r\\n" + \r\n               "Content-Type: application/json\\r\\n" + \r\n               "Content-Length: " + String(payload.length()) + "\\r\\n" + \r\n               "Connection: close\\r\\n\\r\\n" + \r\n               payload);\r\n\r\n  Serial.println(client.readStringUntil(\'\\n\'));\r\n\r\n  client.stop();\r\n\r\n  delay(5000);\r\n}\r\n\r\n\r\nvoid loop() {\r\n  String ssid;\r\n  String bssid;\r\n  int rssi = 0;\r\n\r\n  int networks = WiFi.scanNetworks();\r\n  if (networks > 0) {\r\n    sendDataToAPI(esp_id, networks);\r\n  }\r\n\r\n  delay(5000);\r\n}\n'})})]})}function p(n={}){const{wrapper:e}={...(0,a.R)(),...n.components};return e?(0,o.jsx)(e,{...n,children:(0,o.jsx)(l,{...n})}):l(n)}},8453:(n,e,i)=>{i.d(e,{R:()=>s,x:()=>d});var r=i(6540);const o={},a=r.createContext(o);function s(n){const e=r.useContext(a);return r.useMemo((function(){return"function"==typeof n?n(e):{...e,...n}}),[e,n])}function d(n){let e;return e=n.disableParentContext?"function"==typeof n.components?n.components(o):n.components||o:s(n.components),r.createElement(a.Provider,{value:e},n.children)}}}]);